---
title: "Predicting Box Office Revenue of Movies in Kenya"
author: "Group CineStats"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(scales)
library(broom)

# Absolute path to output folder
output_dir <- "C:/Users/Mia/OneDrive/Desktop/KioiIan/CMT 429/Project Folder/box_office_project/outputs"

# Path to data set generated by analysis_run.R
dataset_path <- file.path(output_dir, "movies_simulated.csv")

# Stop if data set is missing
if (!file.exists(dataset_path)) {
  stop("movies_simulated.csv not found. Run analysis_run.R first to generate it.")
}

# Load data set
movies <- read_csv(dataset_path, show_col_types = FALSE)
```

# 1. Introduction

This report analyzes movie performance using a dataset derived from TMDB and adapted for the Kenyan box office context.  
The goal is to understand what drives revenue and build a predictive model based on production, genre, and audience metrics.

# 2. Data Overview

```{r}
glimpse(movies)
summary(select(movies, budget_ksh, revenue_ksh, runtime, vote_average, popularity))
```

# 3. Exploratory Data Analysis (EDA)

## 3.1 Budget vs Revenue (Log Scale)

```{r fig.width=7, fig.height=5}
movies %>%
  ggplot(aes(x = budget_ksh, y = revenue_ksh)) +
  geom_point(alpha = 0.5) +
  scale_x_log10(labels = scales::label_number(scale_cut = scales::cut_si("K"))) +
  scale_y_log10(labels = scales::label_number(scale_cut = scales::cut_si("K"))) +
  labs(
    title = "Budget vs Revenue (KSh) â€” Log Scale",
    x = "Budget (KSh)",
    y = "Revenue (KSh)"
  ) +
  theme_minimal()
```

## 3.2 Revenue by Genre

```{r fig.width=7, fig.height=5}
movies %>%
  filter(!is.na(primary_genre)) %>%
  group_by(primary_genre) %>%
  filter(n() >= 5) %>%
  ungroup() %>%
  ggplot(aes(x = reorder(primary_genre, revenue_ksh, FUN = median), y = revenue_ksh)) +
  geom_boxplot() +
  scale_y_continuous(labels = scales::label_number(scale_cut = scales::cut_si("K"))) +
  coord_flip() +
  labs(
    title = "Revenue by Primary Genre (KSh)",
    x = "Genre",
    y = "Revenue (KSh)"
  ) +
  theme_minimal()
```

## 3.3 Revenue by Release Season

```{r fig.width=7, fig.height=5}
movies %>%
  ggplot(aes(x = release_season, y = revenue_ksh)) +
  geom_violin(trim = TRUE, fill = "#56B4E9", alpha = 0.7) +
  scale_y_continuous(labels = scales::label_number(scale_cut = scales::cut_si("K"))) +
  labs(
    title = "Revenue Distribution by Release Season",
    x = "Release Season",
    y = "Revenue (KSh)"
  ) +
  theme_minimal()
```

# 4. Predictive Modeling

```{r}
movies_model <- movies %>%
  mutate(
    log_revenue = log1p(revenue_ksh),
    log_budget = log1p(budget_ksh),
    primary_genre = as.factor(primary_genre),
    release_season = as.factor(release_season)
  ) %>%
  drop_na(log_revenue, log_budget)

# Auto-remove invalid factor predictors
factor_cols <- c("primary_genre", "release_season")

for (col in factor_cols) {
  if (col %in% names(movies_model) && nlevels(movies_model[[col]]) < 2) {
    warning(paste("error", col, "has <2 levels and will be removed from model."))
    movies_model[[col]] <- NULL
  }
}

# Build model dynamically using remaining variables
predictors <- setdiff(names(movies_model), c("log_revenue"))
model_formula <- as.formula(
  paste("log_revenue ~", paste(predictors, collapse = " + "))
)

lm_fit <- lm(model_formula, data = movies_model)
model_summary <- broom::tidy(lm_fit)
model_summary

```

# 5. Key Findings

```{r}
head(model_summary, 10)
```

**Interpretation Highlights:**

- Budget has the strongest positive relationship to revenue.
- Higher audience ratings (vote_average) correspond to higher sales.
- Genre and release season act as categorical predictors with significant effects.

# 6. Conclusion

- The model confirms that budget, popularity, genre, and seasonal timing significantly affect box office outcomes.  
- Results suggest strategic investment and timing can improve revenue forecasts in the Kenyan market.  
- Future work: extend model to streaming platforms and local film distributors.

# 7. Session Information

```{r}
sessionInfo()
```
